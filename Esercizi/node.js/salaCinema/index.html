<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sale Cinema</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <link href="style.css" type="text/css" rel="stylesheet" />
</head>


<body class="bg-primary">
    <header class="position-relative" id="hd">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="" fill="rgb(255, 221, 0)" class="bi bi-film"
            viewBox="0 0 18 15">
            <path
                d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm4 0v6h8V1zm8 8H4v6h8zM1 1v2h2V1zm2 3H1v2h2zM1 7v2h2V7zm2 3H1v2h2zm-2 3v2h2v-2zM15 1h-2v2h2zm-2 3v2h2V4zm2 3h-2v2h2zm-2 3v2h2v-2zm2 3h-2v2h2z" />
        </svg>

    </header>
        <div class="container">
            <div class="row ">
                <h3 class="text-center bg-warning rounded-4 text-light mt-2"
                    style="background-color:rgb(255, 221, 0); height: 40px;">Cinemas</h3>

                <div id="carouselExampleIndicators" class="carousel slide rounded-4" data-bs-ride="carousel"
                    style="background-color: rgb(6, 6, 92); height: 22em;">
                    <ol class="carousel-indicators">
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"></li>
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"></li>
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"></li>
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3"></li>
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4"></li>
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="5"></li>
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="6"></li>
                        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="7"></li>
                    </ol>
                    <div class="carousel-inner mt-4" id="carosello">
                        <div class="carousel-item active">
                            <img class="d-block w-100" src="imgIlRitorno.jpg"
                                style="max-height: 300px; object-fit: contain;" alt="First slide">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="imgMatrix.jpg"
                                style="max-height: 300px; object-fit: contain; ">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="imgInterstellar.jpg" alt="Third slide"
                                style="max-height: 300px; object-fit: contain;">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="imgOppenheimer.jpg"
                                style="max-height: 300px; object-fit: contain;">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="imgDune.jpg"
                                style="max-height: 300px; object-fit: contain;">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="imgAvatar.jpg"
                                style="max-height: 300px; object-fit: contain;">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="imgIncep.jpg"
                                style="max-height: 300px; object-fit: contain;">
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="imgthebatman.jpg"
                                style="max-height: 300px; object-fit: contain;">
                        </div>
                    </div>

                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </a>
                </div>

                <div class="row mt-3">

                    <div class="col-6">
                        <select class="form-select w-40 rounded-3" id="elencoFilm" aria-label="Default select example">
                            <option selected>Visualizza Elenco Film</option>
                        </select>
                    </div>

                    <div class="col-6">
                        <select class="form-select w-40 rounded-3" id="elencoSale" aria-label="Default select example">
                            <option selected>Visualizza Elenco Sale</option>
                        </select>
                    </div>
                </div>

                <div class="row" style="background-color: rgb(6, 6, 92)">
                    <div class="col-6">
                        <div id="cardFilm" class="card mx-auto mt-5 mb-5 d-none" style="width: 18rem;">
                        </div>
                    </div>

                    <div class="col-6">
                        <div id="cardSala" class="card mx-auto mt-5 d-none" style="width: 18rem;">
                        </div>
                    </div>
                </div>

            </div>
        </div>

    <script>

        $(document).ready(function () {
            $.get('http://localhost:3000/getFilm', function (data) {
                data.forEach(film => {
                    $("#elencoFilm").append(`<option value="${film.id_sala}">${film.nome}</option>`);
                });
            });

            $.get('http://localhost:3000/getSale', function (data) {
                data.forEach(sala => {
                    $("#elencoSale").append(`<option value="${sala.id_sala}">${sala.nome_sala}</option>`);
                });
            });


            $("#elencoFilm").on("change", function () {
                const id = $(this).val();

                $.get(`http://localhost:3000/getfilmByIdSala/${id}`, function (risultato) {

                    if (risultato.length > 0) {
                        $("#cardFilm").removeClass("d-none");
                        const film = risultato[0];

                        $("#cardFilm").html(`
                            <div class="card mx-auto" style="width: 18rem;">
                                <div id="divImm"></div>
                                <div class="card-body">
                                    <p class="card-text">Sala: ${film.nome_sala}</p>
                                    <p class="card-text">Orario: ${film.orario_trasmissione}</p>
                                </div>
                            </div>
                        `);

                        $.ajax({
                            url: "locandineFilm.json",
                            method: "GET",
                            success: function (data) {
                                const idFilm = film.id_film;
                                const locandina = data.find(img => img.id == idFilm);
                                if (locandina) {
                                    $("#divImm").html(`<img src="${locandina.loc}" class="card-img-top">`);
                                } else {
                                    $("#divImm").html(`<p>Locandina non trovata</p>`);
                                }
                            },
                            error: function (error) {
                                console.error("Errore nella richiesta delle locandine", error);
                            }
                        });

                    } else {
                        $("#cardFilm").html(`
                        <div class="card mx-auto" style="width: 18rem;">
                            <div class="card-body">
                                <p class="card-text">Nessun film disponibile per questa sala.</p>
                            </div>
                        </div>
                    `);
                    }

                });
            });

            $("#elencoSale").on("change", function () {
                const id_sala = $(this).val();
                console.log("ID Sala selezionata:", id_sala);

                $.get(`http://localhost:3000/getSalaById/${id_sala}`, function (dati_sala) {
                    if (dati_sala.length > 0) {
                        $("#cardSala").removeClass("d-none");
                        const sala = dati_sala[0];
                        $("#cardSala").html(`
                            <div class="card mx-auto" style="width: 18rem;">
                                <div class="card-body">
                                    <p class="card-text">Nome Sala: ${sala.nome_sala}</p>
                                    <p class="card-text">Numero Posti: ${sala.numeroPosti}</p>
                                </div>
                            </div>
                        `);
                    } else {
                        $("#cardSala").html(`
                            <div class="card mx-auto" style="width: 18rem;">
                                <div class="card-body">
                                    <p class="card-text">Nessuna informazione disponibile per questa sala.</p>
                                </div>
                            </div>
                    `);
                    }
                });
            });
        });
    </script>
    </div>
</body>

</html>