<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <title>Gestione Corsi e Insegnanti</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body class="bg-light">
    <div class="container mt-5">
        <h2 class="mb-4">Gestione Insegnanti e Corsi</h2>

        <div class="mb-3">
            <label for="insegnante" class="form-label">Seleziona Insegnante:</label>
            <select id="insegnante" class="form-select">
                <option value="">-- Seleziona --</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="corso" class="form-label">Seleziona Corso:</label>
            <select id="corso" class="form-select">
                <option value="">-- Seleziona --</option>
            </select>
        </div>

        <div id="infoCorso" class="mt-3 text-primary fw-bold"></div>

        <div id="divTabella" class="mt-4">
            <table class="table table-bordered" id="CorsoInsegnante">
                <thead class="table-light">
                    <tr>
                        <th>Materia</th>
                        <th>Codice Corso</th>
                    </tr>
                </thead>
                <tbody id="aggiungiMateria"></tbody>
            </table>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            $.get('http://localhost:3000/insegnanti', function (data) {
                data.forEach(insegnante => {
                    $("#insegnante").append(`<option value="${insegnante.id_docente}">${insegnante.nome} ${insegnante.cognome}</option>`);
                });
            });


            $.get('http://localhost:3000/corsi', function (data) {
                data.forEach(corso => {
                    $("#corso").append(`<option value="${corso.codice_corso}">${corso.materia}</option>`);
                });
            });


            $('#insegnante').on('change', function () {
                const insegnanteId = $(this).val();
                $('#aggiungiMateria').empty();

                if (!insegnanteId) return;

                $.get(`http://localhost:3000/getCorsiByIdInsegnante/${insegnanteId}`, function (data) {
                    if (data.length === 0) {
                        $('#aggiungiMateria').append('<tr><td colspan="2" class="text-center">Nessun corso assegnato</td></tr>');
                    } else {
                        data.forEach(corso => {
                            $('#aggiungiMateria').append(`
                <tr>
                  <td>${corso.materia}</td>
                  <td>${corso.codice_corso}</td>
                </tr>
              `);
                        });
                    }
                });
            });

            $('#corso').on('change', function () {
                const corsoId = $(this).val();
                $('#infoCorso').text('');

                if (!corsoId) return;

                $.get(`http://localhost:3000/getStudentiByIdCorso/${corsoId}`, function (data) {
                    const numeroStudenti = data[0]['COUNT(id_studente)'];
                    $('#infoCorso').text(`Numero di studenti iscritti: ${numeroStudenti}`);
                }).fail(function () {
                    $('#infoCorso').text('Errore nel recupero del numero di studenti.');
                });
            });
        });
    </script>
</body>

</html>

