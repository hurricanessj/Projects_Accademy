<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <title>Sito Palestra</title>
</head>
<body class>

    <div class="container-fluid p-0">
        <nav class="navbar navbar-light bg-info">
            <a class="navbar-brand d-flex">
                <img class="img-fluid" src="img3fedin.jpg" width="40"
                    class="d-inline-block align-top">
               <p class="mb-0 mt-2"></p>
            </a>
        </nav>
    <div class="container">
        
        <div class="row">
            <h3 class="text-center mt-5">Palestra 3fedin</h3>
            <input class="form-control w-50 rounded-5 shadow-lg mt-5 mx-auto" type="search"
                placeholder="inserisci codice fiscale" aria-label="Search" id="insCF">
            <div class="row">
                <div class=" d-flex justify-content-center align-items-center mt-5 d-none" id="div">
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">La Tua Visita</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalInfo">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="staticBackdropMedico" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Info Medico</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalMedico">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        var persone = [];
        var istruttori = [];
        var corsi =[];

        $.ajax({
            url: "istruttore.json",
            method: "GET",
            success: function (dataIstr) {
                istruttori = dataIstr;
                console.log("JSON istruttori caricato:", istruttori);
            },
            error: function (error) {
                console.error("Errore nella richiesta", error);
            }
        });

        $.ajax({
            url: "persona.json",
            method: "GET",
            success: function (datiPersona) {
                persone = datiPersona;
                console.log("JSON persone caricato:", persone);
            },
            error: function (error) {
                console.error("Errore nella richiesta", error);
            }
        });

        
        $.ajax({
            url: "corso.json",
            method: "GET",
            success: function (datiCorsi) {
                corsi = datiCorsi;
                console.log("JSON corsi caricato:", corsi);
            },
            error: function (error) {
                console.error("Errore nella richiesta", error);
            }
        });

$('#insCF').on('keypress', function (e) {
    if (e.key === "Enter") {
        const valoreInput = $(this).val().trim().toLowerCase();
        const persona = persone.find(p => p.cf.toLowerCase() === valoreInput);

        $("#div").empty().removeClass("d-none");

        if (!persona) {
            $("#div").html(`<p class="text-danger">Nessun utente trovato con questo codice fiscale.</p>`);
            return;
        }

        const oggi = new Date();
        const dataScadenza = new Date(persona.scadenza);
        const diffGiorni = Math.ceil((dataScadenza - oggi) / (1000 * 60 * 60 * 24));
        const classeRiga = diffGiorni <= 7 ? 'table-danger' : 'table-success';


        const tabellaUtente = `
            <table class="table text-center mt-4 ${classeRiga}">
                <thead class="table-light">
                    <tr>
                        <th>Nome</th>
                        <th>Cognome</th>
                        <th>Codice Fiscale</th>
                        <th>Scadenza Abbonamento</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>${persona.nome}</td>
                        <td>${persona.cognome}</td>
                        <td>${persona.cf}</td>
                        <td>${persona.scadenza}</td>
                    </tr>
                </tbody>
            </table>`;


        let cards = '<div class="row justify-content-center mt-4">';
        corsi.forEach((corso, index) => {
            const istr = istruttori.find(i => i.id === corso.id_istruttore);
            cards += `
                <div class="card shadow m-3" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title">${corso.nome}</h5>
                        <p class="card-text">${corso.descrizione}</p>
                        <p class="card-text"><strong>Orario:</strong> ${corso.orario}</p>
                        <p class="card-text"><strong>Istruttore:</strong> ${istr?.nome || 'N/A'}</p>
                    </div>
                </div>`;
        });
        cards += '</div>';

        $("#div").html(tabellaUtente + cards);
    }
});


    </script>
</body>

</html>